
<!DOCTYPE html>
<html lang="en">
<head>
	<title>BearHub</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: Arial, sans-serif;
			background-color: #f5f5f5;
		}
		header {
			background-color: #063573;
			color: #fff;
			padding: 10px;
			text-align: center;
		}
		h1 {
			margin: 20px;
			font-size: 36px;
			text-align: center;
			color: #fe914c;
		}
		.container {
			margin: 20px;
			padding: 20px;
			background-color: #fff;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			border: 3px solid #fe914c;
		}
		.containera {
			display: inline-block;
			border: 3px solid #fe914c;
			border-radius: 30px;
			padding: 10px;
			background-color: #ffffff;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			width: auto;
			height: auto;
		}
        .far-right {
            margin: 20px;
			padding: 20px;
			background-color: #fff;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
		.topnav {
			background-color: #333;
			overflow: hidden;
			box-shadow: 0 2px 4px 0 rgba(0,0,0,.2);
		}
		.topnav a {
			float: right;
			color: #f2f2f2;
			text-align: center;
			padding: 14px 16px;
			text-decoration: none;
			font-size: 17px;
		}
		.topnav a:hover {
			background-color: #ddd;
			color: black;
		}
		.topnav a.active {
			background-color: #04AA6D;
			color: white;
		}
		.topnav a.split {
			float: left;
		}
		table {
    border-collapse: collapse;
    margin: 20px;
    table-layout: auto;
    border-radius: 10px;
    overflow: hidden;
}
		th, td {
			padding: 20px;
			text-align: left;
			width: 100px;
		}
		th {
			background-color: #fe914c;
			color: #fff;
			border: 1px solid #fe914c;
		}
		td {
			background-color: #fff;
			border: 1px solid #ccc;
		}
		tr:nth-child(even) {
			background-color: #f5f5f5;
			color: #04AA6D;
		}
		.table-title{
			justify-content: center; 
			color: #063573;
		}
		button {
	background-color: #3961f0;
	color: #fff;
	padding: 10px 20px;
	border: none;
	border-radius: 5px;
	font-size: 16px;
	cursor: pointer;
	transition: background-color 0.3s;
	}

	button:hover {
	background-color: #3961f0;
	}
	input[type=text] {
		padding: 10px;
        width: 100%;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
        margin-bottom: 20px;
}
.description {
    width: 400px;
}
	</style>
</head>

<body>
	<div class="topnav">
	</div>
	<header>
		<h1>BearHub Admin</h1>
	</header>
	<div class="containera">
		<h2 class="table-title">Events</h2>
		<table id="event-table">
			<tr>
				<th>Event</th>
				<th>Date</th>
				<th>Description</th>
				<th>Point Values</th>
				<th><button class="add-event-btn">+</button></th>
			</tr>
			{% for event in events %}
			<tr>
				<td id="eventname"><input type="text" class = "eventname" value= "{{ event.name }}"></td>
				<td id="date"><input type="text" class = "date" value= "{{ event.date }}"></td>
				<td id="description"><input type="text" class = "description" value= "{{ event.description}}"></td>
				<td id="points"><input type="text"class = "points" value= "{{ event.point_value }}"></td>
				<td><button class="edit-value-btn">Save Values</button></td>
			</tr>
			{% endfor %}
			
		</table>
	</div>
	<script>
		function extractValues() {
		  let values = [];
		  let rows = document.querySelectorAll('#event-table tr');
		  for (let i = 1; i < rows.length; i++) {
			let row = rows[i];
			let nameInput = row.querySelector('#eventname input');
			let name = nameInput ? nameInput.value : '';
			let dateInput = row.querySelector('#date input');
			let date = dateInput ? dateInput.value : '';
			let descriptionInput = row.querySelector('#description input');
			let description = descriptionInput ? descriptionInput.value : '';
			let pointInput = row.querySelector('#points input');
			let point_value = pointInput ? pointInput.value : '';
			values.push({
			  name: name,
			  date: date,
			  description: description,
			  point_value: point_value
			});
		  }
		  return values;
		}
		
		document.addEventListener('DOMContentLoaded', function() {
  let buttons = document.querySelectorAll('.edit-value-btn');
  buttons.forEach(function(button) {
    button.addEventListener('click', function() {
      let values = extractValues();
      console.log(values);
      fetch('{% url "bear:updater" %}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(values)
      })
      .then(response => response.json())
      .then(data => console.log(data))
      .catch(error => console.error(error));
    });
  });
});

function getNewValues() {
  let values = [];
  let rows = document.querySelectorAll('#event-table tr');
  let row = rows[rows.length-1];
  console.log(rows[rows.length-1]);
  console.log(typeof row[row.length-1])

  let nameInput = row.querySelector('#eventname input');
  console.log(nameInput)
  let name = nameInput ? nameInput.value : '';
  let dateInput = row.querySelector('#date input');
  let date = dateInput ? dateInput.value : '';
  let descriptionInput = row.querySelector('#description input');
  let description = descriptionInput ? descriptionInput.value : '';
  let pointInput = row.querySelector('#points input');
  let point_value = pointInput ? pointInput.value : '';
  values.push({
    name: name,
    date: date,
    description: description,
    point_value: point_value
  });

  return values;
}

// get the table element and the button
var table = document.querySelector("table");
var addBtn = table.querySelector(".add-event-btn");

// add event listener to the button
addBtn.addEventListener("click", function() {
  // create a new row
  var row = table.insertRow(table.rows.length);

  // add cells to the row
  var cells = [row.insertCell(),row.insertCell(),row.insertCell(),row.insertCell(),row.insertCell()];

  // add input fields to the cells
  cells[0].innerHTML = '<td id="eventname"><input type="text" class = "eventname" value=" "></td>';
  console.log(cells[0].value);
  cells[1].innerHTML = '<td id="date"><input type="text" class = "date" value=" "></td>';
  cells[2].innerHTML = '<td id="description"><input type="text" class = "description" value =  " "></td>';
  cells[3].innerHTML = '<td id="points"><input type="text"class = "points"value =" "></td>';
  cells[4].innerHTML = '<button class="save-value-btn">Save Values</button>';

  var saveNewValue = table.querySelector(".save-value-btn")
  saveNewValue.addEventListener("click", function() {
    let values = getNewValues();
    console.log(values);
    fetch('{% url "bear:NewEvent" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(values)
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error(error));
  });
});

	
	
</script>
</body>
</html>
