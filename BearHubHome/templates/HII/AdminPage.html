{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<title>BearHub</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="{% static 'style.css' %}" rel="stylesheet">
</head>

<body>
	<div class="topnav">
	</div>
	<header>
		<h1>BearHub Admin</h1>
	</header>
	<div class="containera">
		<h2 class="table-title">Events</h2>
		<table id="event-table">
			<tr>
				<th>Event</th>
				<th>Date</th>
				<th>Description</th>
				<th>Point Values</th>
				<th><button class="add-event-btn">+</button></th>
			</tr>
			{% for event in events %}
			<tr>
				<td id="eventname"><input type="text" class = "eventname" value= "{{ event.name }}"></td>
				<td id="date"><input type="text" class = "date" value= "{{ event.date }}"></td>
				<td id="description"><input type="text" class = "description" value= "{{ event.description}}"></td>
				<td id="points"><input type="text"class = "points" value= "{{ event.point_value }}"></td>
				<td><button class="edit-value-btn">Save Values</button></td>
			</tr>
			{% endfor %}
			
		</table>
	</div>
	<script>
		function extractValues() {
		  let values = [];
		  let rows = document.querySelectorAll('#event-table tr');
		  for (let i = 1; i < rows.length; i++) {
			let row = rows[i];
			let nameInput = row.querySelector('#eventname input');
			let name = nameInput ? nameInput.value : '';
			let dateInput = row.querySelector('#date input');
			let date = dateInput ? dateInput.value : '';
			let descriptionInput = row.querySelector('#description input');
			let description = descriptionInput ? descriptionInput.value : '';
			let pointInput = row.querySelector('#points input');
			let point_value = pointInput ? pointInput.value : '';
			values.push({
			  name: name,
			  date: date,
			  description: description,
			  point_value: point_value
			});
		  }
		  return values;
		}
		
		document.addEventListener('DOMContentLoaded', function() {
  let buttons = document.querySelectorAll('.edit-value-btn');
  buttons.forEach(function(button) {
    button.addEventListener('click', function() {
      let values = extractValues();
      console.log(values);
      fetch('{% url "bear:updater" %}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(values)
      })
      .then(response => response.json())
      .then(data => console.log(data))
      .catch(error => console.error(error));
    });
  });
});

function getNewValues() {
  let values = [];
  let rows = document.querySelectorAll('#event-table tr');
			let row = rows[rows.length-1];
			console.log(row)
			let nameInput = row.querySelector('#eventname-input');
			let name = nameInput ? nameInput.value : '';
			let dateInput = row.querySelector('#date-input');
			let date = dateInput ? dateInput.value : '';
			let descriptionInput = row.querySelector('#description-input');
			let description = descriptionInput ? descriptionInput.value : '';
			let pointInput = row.querySelector('#points-input');
			let point_value = pointInput ? pointInput.value : '';
			values.push({
			  name: name,
			  date: date,
			  description: description,
			  point_value: point_value
			});
		 
		  return values;
		}

// get the table element and the button
var table = document.querySelector("table");
var addBtn = table.querySelector(".add-event-btn");

// add event listener to the button
addBtn.addEventListener("click", function() {
  // create a new row
  var row = table.insertRow(table.rows.length);

  // add cells to the row
  var cells = [row.insertCell(),row.insertCell(),row.insertCell(),row.insertCell(),row.insertCell()];

  // add input fields to the cells
  cells[0].innerHTML = '<td id="eventname"><input type="text" id="eventname-input" class="eventname" value=""></td>';
cells[1].innerHTML = '<td id="date"><input type="text" id="date-input" class="date" value=""></td>';
cells[2].innerHTML = '<td id="description"><input type="text" id="description-input" class="description" value=""></td>';
cells[3].innerHTML = '<td id="points"><input type="text" id="points-input" class="points" value=""></td>';
cells[4].innerHTML = '<button class="save-value-btn">Save Values</button>';


  var saveNewValue = table.querySelector(".save-value-btn")
  saveNewValue.addEventListener("click", function() {
    let values = getNewValues();
    console.log(values);
    fetch('{% url "bear:NewEvent" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}'
      },
      body: JSON.stringify(values)
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch(error => console.error(error));
  });
});

	
	
</script>
</body>
</html>
